(function(){var app=angular.module("experiments.services.experiment-list",[]);app.factory("ExperimentList",["$rootScope",function($rootScope){var experiments=[];var tags=[];var filters=[];var tagColors=["yellow","green","red","blue","purple","pink","yellow2","green2","red2","blue2","purple2","pink2"];var old=new Date(0);return{getExperiments:function(){return experiments},setExperiments:function(_experiments){experiments=this.adaptInformation(_experiments);old=new Date;return this},getExperiment:function(experiment_id){for(var i in experiments){if(experiments[i].experiment_id===experiment_id){return experiments[i]}}return null},addExperiment:function(experiment){var previous=this.getExperiment(experiment.experiment_id);if(previous===null){experiments.push(experiment)}else{return this.updateExperiment(experiment)}this.updateTags();return experiment},updateExperiment:function(_experiment){var previous=this.getExperiment(_experiment.experiment_id);if(previous!==null){for(var i in _experiment){previous[i]=_experiment[i]}}this.updateTags();return previous},deleteExperiment:function(experiment_id){for(var i in experiments){if(experiments[i].experiment_id===experiment_id){experiments.splice(i,1);break}}this.updateTags();return this},getTags:function(){return tags},getTag:function(_tag){for(var i in tags){if(tags[i].name===_tag){return tags[i]}}return null},setTags:function(_tags){tags=_tags;return this},updateTags:function(){var tagsAux={},_tags;for(var i in experiments){_tags=experiments[i].tags;for(var j in _tags){tagsAux[_tags[j]]={name:_tags[j],times:tagsAux[_tags[j]]===undefined?1:tagsAux[_tags[j]].times+1}}}tags.length=0;for(var i in tagsAux){tags.push(tagsAux[i])}for(var i in tags){tags[i].color=tagColors[i%tagColors.length]}tags.push({name:"All",times:experiments.length});return this},getFilters:function(){return filters},setFilters:function(_filters){filters=_filters;return this},removeFilter:function(_filter){var pos=filters.indexOf(_filter);if(pos!==-1){filters.splice(pos,1)}return this},getOld:function(){return(new Date-old)/6e4},adaptInformation:function(_experiments){for(var i in _experiments){var date=_experiments[i].submission_date;if(date.indexOf("/")===-1){date=date.substr(0,4)+"/"+date.substr(4,2)+"/"+date.substr(6,2)}_experiments[i].submission_date=new Date(date);date=_experiments[i].last_edition_date;if(date.indexOf("/")===-1){date=date.substr(0,4)+"/"+date.substr(4,2)+"/"+date.substr(6,2)}_experiments[i].last_edition_date=new Date(date);_experiments[i].tags=arrayUnique(_experiments[i].tags,[""])}return _experiments},isOwner:function(experiment,user_id){for(var i in experiment.experiment_owners){if(experiment.experiment_owners[i].user_id===user_id){return true}}return false},isMember:function(experiment,user_id){for(var i in experiment.experiment_members){if(experiment.experiment_members[i].user_id===user_id){return true}}return false}}}])})();