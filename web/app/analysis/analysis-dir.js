(function(){var app=angular.module("analysis.directives.analysis-views",["analysis.services.analysis-list"]);app.directive("analysisCard",function($timeout){return{restrict:"E",templateUrl:"app/analysis/analysis-card.tpl.html",link:function(scope,element,attrs){$timeout(scope.$eval(attrs.afterRender),0)}}});app.directive("rawDataForm",function(){return{restrict:"E",templateUrl:"app/analysis/rawdata-form.tpl.html"}});app.directive("intermediateDataForm",function(){return{restrict:"E",templateUrl:"app/analysis/intermediatedata-form.tpl.html"}});app.directive("processedDataForm",function(){return{restrict:"E",templateUrl:"app/analysis/processeddata-form.tpl.html"}});app.directive("externalSourceForm",function(){return{restrict:"E",templateUrl:"app/analysis/externalsource-form.tpl.html"}});app.directive("analysisDiagram",["$compile","$dialogs","$http","AnalysisList",function($compile,$dialogs,$http,AnalysisList){return{restrict:"E",replace:true,link:function($scope,element,attrs){var createDiagram=function(){var template='<div class="sigmaContainer" id="'+attrs["container-id"]+'"style="'+(attrs["style"]||"")+'"></div>';$compile($(template).appendTo(element))($scope)[0];var diagram=$scope.diagram||{nodes:[],edges:[]};$scope.controller.sigma=new sigma({graph:diagram,renderer:{container:document.getElementById(attrs["container-id"]),type:"canvas"},settings:{edgeColor:"default",defaultEdgeColor:"#d3d3d3",mouseEnabled:true,sideMargin:100,labelAlignment:"bottom",autoRescale:false}});if(attrs.selectable!==undefined){$scope.controller.sigma.selectable=true;$scope.controller.sigma.bind("clickNode",function(event){var node=event.data.node;if(node.id===$scope.model.step_id){return}if(node.selected==="false"){if($scope.controller.addSelectedInputFileHandler(node.id,true)){node.selected="true"}}else{if($scope.controller.removeSelectedInputFileHandler(node.id,true)){node.selected="false"}}})}applyStyles()};var updateDiagram=function(){var diagram=$scope.diagram||{nodes:[],edges:[]};$scope.controller.sigma.graph.clear();$scope.controller.sigma.graph.read(diagram);applyStyles()};var applyStyles=function(){var diagram=$scope.diagram||{nodes:[],edges:[]};var myPalette,myStyles;if($scope.controller.sigma.selectable===true){for(var i in diagram.nodes){diagram.nodes[i]["selected"]=$scope.model.used_data.indexOf(diagram.nodes[i].id)!==-1?"true":"false";if(diagram.nodes[i].id===$scope.model.step_id){diagram.nodes[i]["selected"]="current"}}myPalette={nodeColorScheme:{"true":"#6aed80","false":"#d8d8d8",current:"#fc7d71"},iconScheme:{"true":{font:"FontAwesome",content:"",scale:.7,color:"#ffffff"},"false":{font:"FontAwesome",content:"",scale:.7,color:"#ffffff"},current:{font:"FontAwesome",content:"",scale:.7,color:"#ffffff"}}};myStyles={nodes:{icon:{by:"selected",scheme:"iconScheme"},color:{by:"selected",scheme:"nodeColorScheme"}}}}else{myPalette={nodeColorScheme:{rawdata:"#cbc600",intermediate_data:"#1fa7cb",processed_data:"#c075e5",external_source:"#779b9a"},iconScheme:{rawdata:{font:"FontAwesome",content:"",scale:1,color:"#ffffff"},intermediate_data:{content:"I",scale:.7,color:"#ffffff"},processed_data:{content:"P",scale:1,color:"#ffffff"},external_source:{content:"R",scale:.7,color:"#ffffff"}}};myStyles={nodes:{icon:{by:"step_type",scheme:"iconScheme"},color:{by:"step_type",scheme:"nodeColorScheme"}}}}if(!$scope.controller.sigma.design){$scope.controller.sigma.design=sigma.plugins.design($scope.controller.sigma,{styles:myStyles,palette:myPalette})}else{$scope.controller.sigma.design.setPalette(myPalette);$scope.controller.sigma.design.setStyles(myStyles)}$scope.controller.sigma.design.apply();var listener=sigma.layouts.dagre.configure($scope.controller.sigma,{directed:true,rankdir:"LR",easing:"quadraticInOut",duration:800});listener.bind("stop",function(event){if($scope.controller.sigma.graph.nodes().length){var dom=document.getElementById(attrs["container-id"]);var w=dom.offsetWidth,h=dom.offsetHeight;var xMin=Infinity,xMax=-Infinity,yMin=Infinity,yMax=-Infinity,margin=50,scale;$scope.controller.sigma.graph.nodes().forEach(function(n){xMin=Math.min(n.x,xMin);xMax=Math.max(n.x,xMax);yMin=Math.min(n.y,yMin);yMax=Math.max(n.y,yMax)});xMax+=margin;xMin-=margin;yMax+=margin;yMin-=margin;scale=Math.min(w/Math.max(xMax-xMin,1),h/Math.max(yMax-yMin,1));$scope.controller.sigma.camera.goTo({x:(xMin+xMax)/2,y:(yMin+yMax)/2,ratio:1/scale})}});sigma.layouts.dagre.start($scope.controller.sigma)};$scope.$watch("diagram",function(newValues,oldValues,scope){if($scope.diagram!==undefined&&!oldValues||$scope.diagram!==undefined&&$scope.controller.sigma===undefined){createDiagram()}else if($scope.diagram!==undefined){if(newValues.hasChanged&&newValues.hasChanged!==oldValues.hasChanged){updateDiagram()}}},true)}}}])})();