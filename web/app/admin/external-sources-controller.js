(function(){var app=angular.module("external-sources-controllers",["ang-dialogs","ui.bootstrap","external-sources.services.external-sources-list"]);app.controller("ExternalSourceListController",function($rootScope,$scope,$http,$dialogs,$state,$interval,$uibModal,APP_EVENTS,ExternalSourceList){this.retrieveExternalSourcesListData=function(force,callback_caller,callback_function){$scope.isLoading=true;if(ExternalSourceList.getOld()>1||force){$http($rootScope.getHttpRequestConfig("GET","external-sources-rest",{})).then(function successCallback(response){$scope.isLoading=false;$scope.externalSources=ExternalSourceList.setExternalSources(response.data).getExternalSources();if(callback_function!==undefined){callback_caller[callback_function]()}},function errorCallback(response){$scope.isLoading=false;debugger;var message="Failed while retrieving the externalSources list.";$dialogs.showErrorDialog(message,{logMessage:message+" at ExternalSourceListController:retrieveExternalSourcesListData."});console.error(response.data)})}else{$scope.externalSources=ExternalSourceList.getExternalSources();$scope.isLoading=false}};this.editExternalSourceHandler=function(externalSource){$scope.model=externalSource;this.addNewExternalSourceHandler(true)};this.addNewExternalSourceHandler=function(isUpdate){$scope.isUpdate=isUpdate;var modalInstance=$uibModal.open({controller:"ExternalSourceController",controllerAs:"controller",size:"md",scope:$scope,templateUrl:"app/admin/external-source-details.tpl.html"});modalInstance.result.then(function(selectedItem){delete $scope.model;delete $scope.isUpdate;me.retrieveExternalSourcesListData(true)},function(){delete $scope.model;delete $scope.isUpdate;me.retrieveExternalSourcesListData(true)})};this.deleteExternalSourceHandler=function(externalSource){var sendRemoveRequest=function(option){if(option==="ok"){$http($rootScope.getHttpRequestConfig("DELETE","external-sources-rest",{extra:externalSource.source_id})).then(function successCallback(response){if(response.data.success){me.retrieveExternalSourcesListData(true)}},function errorCallback(response){$scope.isLoading=false;debugger;var message="Failed while deleting the external source.";$dialogs.showErrorDialog(message,{logMessage:message+" at ExternalSourceListController:deleteExternalSourceHandler."});console.error(response.data)})}};$dialogs.showConfirmationDialog("Are you sure?",{title:"Remove the selected external source?",callback:sendRemoveRequest})};var me=this;$scope.externalSources=ExternalSourceList.getExternalSources();this.retrieveExternalSourcesListData(true)});app.controller("ExternalSourceController",function($rootScope,$scope,$http,$dialogs,$uibModalInstance,APP_EVENTS,ExternalSourceList){this.saveExternalSourceDetailsHandler=function(){$http($rootScope.getHttpRequestConfig($scope.isUpdate?"PUT":"POST","external-sources-rest",{data:{external_source_json_data:$scope.model},extra:$scope.isUpdate?$scope.model.source_id:""})).then(function successCallback(response){$dialogs.showSuccessDialog("External source succesfully saved.");$uibModalInstance.dismiss("cancel")},function errorCallback(response){$scope.isLoading=false;debugger;var message="Failed while saving the external source.";$dialogs.showErrorDialog(message,{logMessage:message+" at ExternalSourceListController:saveExternalSourceDetailsHandler."});console.error(response.data)})};this.closeExternalSourceDetailsHandler=function(){$uibModalInstance.dismiss("cancel")};var me=this;if(!$scope.model){$scope.model={}}})})();